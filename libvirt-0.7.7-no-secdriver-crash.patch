commit b7a7b3365145f6e9e434a3265a58666cd2e6d8dd
Author: Guido GÃ¼nther <agx@sigxcpu.org>
Date:   Wed Mar 17 21:04:11 2010 +0100

    Don't crash without a security driver
    
    "virsh dominfo <vm>" crashes if there's no primary security driver set
    since we only intialize the secmodel.model and secmodel.doi if we have
    one. Attached patch checks for securityPrimaryDriver instead of
    securityDriver since the later is always set in qemudSecurityInit().
    
    Closes: http://bugs.debian.org/574359

diff --git a/src/qemu/qemu_driver.c b/src/qemu/qemu_driver.c
index 1f2b11d..257f914 100644
--- a/src/qemu/qemu_driver.c
+++ b/src/qemu/qemu_driver.c
@@ -4979,7 +4979,7 @@ static int qemudNodeGetSecurityModel(virConnectPtr conn,
     int ret = 0;
 
     qemuDriverLock(driver);
-    if (!driver->securityDriver) {
+    if (!driver->securityPrimaryDriver) {
         memset(secmodel, 0, sizeof (*secmodel));
         goto cleanup;
     }
